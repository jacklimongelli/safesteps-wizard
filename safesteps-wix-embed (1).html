<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Safe Steps ‚Äî Family Emergency Sheet Builder</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  body{font-family:'Inter',-apple-system,sans-serif;background:#0b1e3d}
  input:focus{outline:none} button{font-family:inherit}
  @keyframes spin{to{transform:rotate(360deg)}}
  @keyframes pulse{0%,100%{opacity:.4}50%{opacity:1}}
  .tbl-input{border:none;background:transparent;font-family:inherit;font-size:0.78rem;color:#141c2b;padding:5px 7px;width:100%;outline:none}
  .tbl-input:focus{background:#f0f4ff}
  button:hover{opacity:.88}
  @media print{body>*{display:none!important}#printable-sheet{display:block!important;position:fixed;top:0;left:0;width:100%}}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const{useState,useCallback}=React;

const WIX_SITE_URL="https://www.safestepsplans.com";
const PROXY=WIX_SITE_URL+"/_functions/places";
const LOGO_SRC="data:image/png;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4gHYSUNDX1BST0ZJTEUAAQEAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADb/2wBDAAUDBAQEAwUEBAQFBQUGBwwIBwcHBw8LCwkMEQ8SEhEPERETFhwXExQaFRERGCEYGh0dHx8fExciJCIeJBweHx7/2wBDAQUFBQcGBw4ICA4eFBEUHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh7/wAARCACJASgDASIAAhEBAxEB/8QAHQABAAMBAAMBAQAAAAAAAAAAAAcICQYCBAUBA//EAEwQAAEDAwIDBAIMCggGAwAAAAEAAgMEBQYHEQgSIRMxQVEiYQkUFRgyNzhCVnF1sxYjUnaBkZOVwtM1U1VicoK00nN0kqGxsqLB0f/EABcBAQEBAQAAAAAAAAAAAAAAAAADAQL/xAAiEQEBAAIBAwUBAQAAAAAAAAAAAQIxAxESsSEyM0FxE2H/2gAMAwEAAhEDEQA/ALloiICIiAiIgIiICL1LVc7ddad9RbK2CshZM+F74XhwbIxxa5p28QQQvbQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAUDaqZ9fs4ymXSnSuYiq35L5e2b9lQxdzmNcPneBI8fRHXct/NWdQb7meUSaUaVS89e7mZerwwns6CPuc1rx87wLh3H0R6W/LJulOn9h05xaKx2SLmcdn1VU8fjKmTbq93/0O4BWknHO67c7QbUY7f+Gy9QZBY5q2+4FV9nFeaZ2xlp5dg3tgO4bnqD3fMcfguVkMdvNsyGyUl6s1ZFWUFXGJIZozuHA/+CO4g9QQQeq9qtpqatpJqOsgiqKadhjlilaHMe0jYtIPQgjwVbaqG8cOGYmto21Vx0xu847eL4b7ZK4948dvI/OHQ+kAS+X98mll0Xq2m4UN2tlNc7bVRVdHUxiWGaJ3M17T3EFe0ouhERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBQLq9qJfMsyd+k+lMokusoLbvd43kR2+PfZ7Q4dzhvsXDqO4ekfR/prBqLfckyY6UaVPMt6m9G63WN34u3xdzwHDucPEjqO4buPSQ9IdObHpti7LRammapl2fXVsgHaVMnmfJo3OzfAeZJJtJMJ3Zb+nO3npLp5YtOMXZZrPGZJn7PrKx4/GVMni53kPIdwHr3J7BEUrbb1roXqXi20F4tdTa7pSRVdFVRmKeGVu7XtPeCvbRYK00VXeOHLMmWu4SVNx0zvFRtS1DjzvtkrupafV4kfOA5h6QcDZGiqqato4ayjniqKadgkilicHMe0jcOBHQgjxXp5LZLXkdiq7JeqOOsoKuPs5oXjoR4H1EHYgjqCAVAONXi78PuWw4flNVPXafXKV3uPdJOrqB5O5jk28OvXw+cPnAW+Wf75c6WPReMUkc0TJYntkje0OY9p3Dge4g+IXkouhERARfGzPKcfw3H57/k10p7ZboNg+aUnqT3NaB1c4+AAJKrje+NjB6atkhtOKX24QNJDZpXxwB/rA3cdvr2PqCC06Kr+M8aeAV9fHTXvHr3Z4nu2NQOSoYz1uDSHbfUCfUrGYnkVlyvHqTIMer46+2VjS6CojBAeAS09CAQQQQQRuCEH1ERVrzPjCwfHMsulhZYLxchb6l9M6qpnxdlK5h2cW7u3I3BG/jtugsoi5/TjLbZnWD2nLLRzCkuVOJWseQXRu7nMdt05muBafWF0CAirrqTxY4pg+c3bE67F71VVNsn7GSaF8QY87A7jd2/iue9+5hX0OyH9pD/uQWrRVU9+5hX0OyH9pD/uUy6r6tWnTzTS351cLXW1lJXSQMZBAWiRplYXjfc7dANkEjIqqe/cwr6HZD+0h/3J79zCvodkP7SH/cgtWiibh/1ysesU94is9muNtNqbC6Q1TmHn7Qv225Se7kP61LKAiIgIiICIiAiIgKDNYtRr5fclOlOlZM9/m3ZdLkw/irdF870/B436n5vcN3Hp5ayakXu8ZEdKtLNqrI6gOZcrgwns7ZH3O3cO5436n5u4A3cQB3ej2m1k02xsW22j2zWzntK+4SN2lqpPM9+zR4N36de8kk2kmE7st/TnfpH7o/pvY9NcZba7W3t6ybZ9fXPbtJVSeZ8mjc7N36b+JJJ7VEUrbb1roREWAiIgL4+Z4zZsvxyrx+/Ujaqhqmcrmno5p8HtPg4HqCvsItl6esFd8DyW86J5XBpvn9W6pxirdtj98kPoRN327GQn4IG4HU+h/hIIsQCHAEEEHqCFz2oeH2TOsVqsdv1P2tLON2vb0khkHwZGHwcP+/UHcEhQ/pXmF80wyuHSfUqp56V5LcdvbyezqI99mxOce49QBufROze7lKrZ/SdZtzpYFERRdKJ+yQX+5zaiY/jDpJWWyltYrWR7kNfNJLIwuI7js2MAeW7vNdJwj6CaUZnphSZTkTTkN0qJJBUUorXxsoi17mtY5sTg7mIaHekeocNht1Mv8UehVHq/Z6aroa2O3ZJbo3Mo6iUExTMPXspdhuBv1Dhvy7nod1TO9aI67adXI1VBYL414BDa2wTOm5m/XCedo/xAILWZ1wgaWXmglGOMuGM1xb+KkhqX1EQd/eZKSSPUHNU54dYKHFsUtWN21pFJbaSOliJABcGNA5jt4nbc+slZ54JxRav4fWRUl1ufu/SUzuSWku0W8vToQZQBJzetxdt4gq9+i+olo1RwGjyu0RyU7ZHGGpppCC6nnbtzsJHf3gg9NwQdhvsA+RxMZ+NONHrzfoJuyuUzPadt6bn2xICGuHh6IDn9fyFnLhmnl9y3Ccvy+iDjSY1TxT1G7C4zF79nAH+6wPeT12DfWFM/sgmf/hBqVS4XRTuNBj0e9QGv9F9VIAXdB0PKzlb16gl4U78LlJp5h2gtFYbvk+NtrL1C+ru8Mt0h3Lpm7dm4F3Tlj5GlvmHeaCOfY59Qet402uE7AOtytgcdiT0bMwefzHAD++fquYsq6aun0c159uWO5suMVgup7Gpgka5tZS77d7SW+nE7Y7d3MfJakWO50d6stDeLdL21FXU8dTTybbc0b2hzT+ohBmHxXfKJzT7Q/gard4xwo6PV+NWuvqbddTNU0cM0hFweAXOYCen1lVE4rvlE5p9ofwNXQW/ip1koLfT0NNe7e2CnibFGDboiQ1oAHXbyCC1nvRtGP7Mu37xevj8fVHBb+HO30FMCIKa7UkMYJ3Ia2KUDr9QURaKcS2rOUatYxjt4vFDLb7hcYoKhjKCJhcxx2IBA3CmX2Qz4hIPtun+7lQV64LNJ8O1TuGTw5dTVc7LdFTOp+wqHRbF5kDt9u/4IVlfejaMf2Zdv3i9Ud0ltWqdznuI0xORiWNsZrvciqfCeUl3Jz8jhv3O239akD8FOK/8AK1J/es/8xBd7SLR/CtLJbjJiNLWQOuLY21Hb1Lpdwzm5dt+74RUgKK+FWizSg0coabPvdb3dFTOZfdOZ0s/IZDybucSdtu7qpUQEREBERAREQEREHqU9rttNc6q509BTQ11W1jamoZEGyTBm/LzOHV22523UJ8bEkkenOPGORzCcmpgS07bjsZ+indQNxufFxjv5z033M6rw++My0nlERSaIiICIiAiIghHTx73cW2pbHPcWtt9DytJ6DeGHfZTDcrTbLlPRT3Cgp6qWhm7eldLGHGGTlLeZu/cdiVDmnXyudTfs+h+5hU4KnJufk8MgiIptQFxE8RtHpLn1lx1lojvEc1O6oujGTck0DHECLkPwebo8lp7xy9Rvuvbxvit0Xu1EJ6vIKuzTeNPXUEvOP0xte0/9W67DVfRnT3UxjpMmsbDcOz7OO40zuyqWAd3pDo4DwDg4de5QddOCHF5akutmcXilg8GVFJHM4f5gWf8AhBEnGrqnp7qReLMMLpTVVFCJBVXZ1KYe3a7l5YxzAPcGkOO7gNt+neVLPCTcZtLOFLJM9v3NHSy1c1bQU8pLWzbRxxR7eO8kreXfyAK6fBeD3TSw3GCvvNXdcjfC7mFPVObHTuPhzMYNyB37F2x8QR0UnaxaVWbUvDaPEq25XCz2mlmZKIbYI4w7kaWsYQ5hAa3foBt3DyCDOfTLCMn1r1NqrbQ1VO25Vvb3Ctq6ouEbOvM5zuUE9XuA6DvcFMvvJc/+leMf9U/8tWf0I0MxPSCa6VNhqrhX1VxbGySeuMbnxsaSeVpY1uwJO58+UeSlRBmbrjw65hpPjFNkV2uNsuVDNUime6iMhMLi0lpdzNHQ7Eb+e3mFZT2PjP8A3d06rMIrpuaux+Tnpud+7n0shJAG/X0H8w8gHMCnrUzDLRqBhFyxG+dsKGvYGufC4CSNzXBzXtJBG4cAeoI8+ijPR7hrxbS/NocqsGSZDNUMhkgkgqXwmKWN46tcGxg9CGuGx72hBSfiu+UTmn2h/A1aTYRb6A4XYyaGmJNupySYm/1bfUof1F4UcHzfNrrllyyDIqeruU3bSxU8kIjadgNm80ZO3TxKnm00UdttVJboXPfHSwMgY5/wiGtDQTt49EH7HQ0Ubw+Ojp2Oadw5sQBH/ZV79kM+ISD7bp/u5VYxcRrVprZ9VcOZjF7rq+jpWVbKoSUbmB/MwOAHpNcNvSPggpJwW6sYfpZcMnmy6oq4WXGKmbT9hTmXcsMhdvt3fCCsr77rRn+0rv8Au565v3k+nX0nyr9rT/yk95Pp19J8q/a0/wDKQSvpNrfgWp96qrRidXXTVVLTe2ZRPSuiAZzNb0J7zu4KSlD+hnD9i2keRV17sN4vNbPWUntV7K18RaG87X7jkY077tCmBAREQEREBERAREQFA3G58XGO/nPTfczqeVA3G58XGO/nPTfczqvD74zLSeURFJoiIgIiICIiCD9Ovlc6m/Z9D9zCpwUH6dfK51N+z6H7mFTgqcu5+TwzEREU2i/Hvaxhe9zWtHeSdgFXDjT1xvGmlFb8YxN8cF9ukLqiSscA40kAdygtaQQXPIeNz3cp6bkEVSw7SjWfWKl/CGmpbjdqN7i1txutfsyQgkHkdK7meAdwS0EAgjvQaeMc17Q5jg5p7iDuCv1Zn3XSXX/SrmutFbb9QQRbyPqrJWGVrQ3qXPELiQAO/mAGynziCwTWjNdHdOmU0VdecmhjlnvL4pIqN0bpGsLWObzMG7fg9PFpPTdBbRFl/l2k+uGJY7V5DkNou9Da6MNNRUOucbwwOcGjo2Qk9XAdB4rmtPrFqJn95ms+IG53SuhpzUyRMrhGWxBzWl273gd72jv36oNZUWfOlWievNq1QxS6XfH7tFbaO9UdRVvfc4XNbCydjnkgSkkBoPQArx4+LncqTXx8VLcKuCP3KpjyRzOaN/T8AUGhCLMfD9G9dsuxujyPHrVcK211rS+nn92oI+cBxaTyvmDh1B7wF9b3u/Eh9Hbh+/6X+eg0iRR1pDZr7jegVpsuSQyU94o7VIyqY6Zsrmv9M/DaSD0I6glZlWCXK79e6Ky2ivuNVcK6ZsFNCKtzTJI47NbuXADc+ZQa9Is0ptEeIqgYaoY5kLSzrvBco3v/AEBkpP6l/fSniA1O0tyn3NyOtut0tsE/ZXC03V73TRbdHBjpPTjcPye7fvHig0mRcRlmpdhsejlRqdG81NqFuZW0rSeUzGQARR9x5S5zmt8dt/Us+Lvl+sWvebSW2jqbpc56gOdFaqObsqWCIHxbuGADcDnedz03Pcg07ZLE97mMkY5zfhNDgSPrXms2qrhd1ys1O26UtgjkmiHPy0Vyi7dn1ekNz/hJKsPwNv1dc7IqXP62+i1W4sp6aku8ZMwqHbOcQ+QdpytYG9N+X8YCEFnkREBERAREQFA3G58XGO/nPTfczqeVA3G58XGO/nPTfczqvD74zLSeURFJoiIgIiICIiCD9Ovlc6m/Z9D9zCpwUH6dfK51N+z6H7mFTgqcu5+TwzEREU2qS+yL4LepMls+oFJSTVFqFvbb6yRg5hTPZI9zC7yDhJsD3bt69SN+T4e+Kev03xSiw+943Hd7PRuf7Xmp5uyqImueXkEEFr+rnbfBPXv6K+t0uVkhrKay3SuoGVFybI2npKiRodVBu3OGsd8PYOG4G/eoqzfhj0dyhrnjGvcSpJ37e0ymn29XZ9Y//ig9fT3ij0ky6oZSSXeox+se4NZFd4hE15PlI0uYP8zgptY5r2h7HBzXDcEHcELNnir0Kp9Ha211drvr7larq6RkMdQ0NqIXMDSQ4jo8ekPSAHlt4mzXsfmTXa+6M1dvuk81Qyz3J1LSSyEuIhMbHiPc/klx28gWjuCDr+Mr5NOYf8Gn/wBVEqwexxfHZevzcm/1NMrP8ZXyacw/4NP/AKqJVg9ji+Oy9fm5N/qaZBf1Z2eyBfKBf9k038a0TWdnsgXygX/ZNN/Gg7nQ7irw7AtKbFiNyx2/VVXbYXxyS04i7NxMj39OZ4Pc4eC7qh40sDq62ClZiuStdNI2MEiDYEnb+s9a9fhw4f8ASPLtE8ayPIcS9u3StgkfUT+6NVHzkSvaDyslDR0A7gFI1Pww6G09RHUQ4RyyRPD2O91a07EHcHrMglW//wBBXD/lpP8A1Kyx4dvj3wf7cpfvGrU6/wD9BXD/AJaT/wBSshsWpbzW5JbqTHRUm8TVDGUQppOSXtSfR5XbjY77bHcINhlnDx3XLH7lr5UvsMtPNJBQQwXGSDYg1LS7cEjvcGdm0/Vt4Lwn0u4obnEaOrocyqIn9HR1F43Yfr5pdl2WjnB7ldzusFfqPLDZbXG8OkoYZmy1NQB83maS1jT57k+od6CSMSwLIMx9j+ocXp2OF2mpX1lFE/cGRrax08bP87AA3w9Jvgqo6L6jZBoxqFPeqW1RTVTYZKGtoq1rmHkLmlzfNjg5jeux7u5ajsbasdsDWN9r261W2l2G5DIqeGNv6g1rR+oLkcw0y0v1KhZdL5jdnvJqIh2dwgPLJIz5u00RDiPLrsgiDDeM7Tu5vp4Mis95sEsh2klDW1MEfrLm7PI+pn6FYLDsqxzMLMy8YxeaO7ULjy9rTSB3K78lw72u9RAKqrrRwgYra8Ou2RYdkFfQz26mlq3U1xe2SGRjGlxYHgNLDsDsTzeR8xEPArkF2tXEFaLTRVUjKG8RTwVsG/oSNZDJIwkeYcwbHv6keJQaQoiICIiAiIgKEOMq23G56fWCG20FVWysyOnkeynhdI5rBFOC4hoOw6jr61N6LrDLtylZZ1ERFy0REQEREBERBDGAW+vh4qtRrhNQ1MdHUUFE2GodE4RyEQwghrttjsQe7yUzoi6yy7mSdBERctVO40tG9T89yuhybFjBdbfQUnZQ2+OUQz07geZ7xzEB5cdu4g+i0bHbcwRbsl4osaLqOGTUSLlHJyVNDPOB4dO0Y7b9C0oRBmlQ6Xa+aw5NHPfbZf5ZGgMdcL8HwRQMJ32b2gBIBJPKwE9e5Xz0L03tulentJitundVSB7qisqXN5TPUOADn7eA2a0AeAaNyT1XdIgi3ixtdyvXD5lVss9vqrhXTxQCKmpYXSySEVERPK1oJOwBPTwCrnwC4VmON6v3euyHFL5aKWSwSxMmraCWFjnmopyGhzmgE7NJ29RV3kQFQ7jiwXNch1yfcLDiN+utH7mU7O3o7fLNHzDm3HM1pG48lfFEGY1kpuJOyWuC1Weh1Nt9BTgthpqemrI44wSSQGgbDqSf0r3fbnFL56rfs63/APFpYiCIeHD8MKjh5phmrby+/vZWNmbc2ye2SO0k5AQ/0vg7berZUt0H021Dt2tGHV9wwTJqSkp7zTSTTzWuZkcbBICXOcW7AAeJWmCICIiCP+IbE8lzjSW8Yvilzgt9wrWNa50xc1ssYO7ouYdW8wHKTsRsSD0Kog3EeI7SqqdQWu35nbYg7n2tTpKilefP8UXRk+o9fMLS9EGaV+uHEvn9L7hXWmzu40tRtG+mNvlhhk6jbn5WNaRuAd3dPFWK4Q+HG5YDdxnGbmFt8ETo6GgikEgpA4bOe97Tyl5aS0BpIAJ6knpaNEBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREH//Z";

const NAV="#0b1e3d",RED="#c0181c",BLUE="#1a3a6b",STEEL="#2b4270";
const ICE="#e9eef7",RULE="#c5cede",LABEL="#5a6a85",TEXT="#141c2b";
const FILL="#f6f8fc",WHITE="#ffffff";

async function placesCall(body){
  const res=await fetch(PROXY,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(body)});
  if(!res.ok) throw new Error("HTTP "+res.status);
  return res.json();
}

async function getDriving(origin,destLat,destLng){
  try{
    const res=await placesCall({type:"directions",origin,dest:destLat+","+destLng});
    if(res.error)return null;
    return{distance:res.distance,duration:res.duration};
  }catch{return null;}
}

async function searchNearby(address,placeType,keyword){
  const geo=await placesCall({type:"geocode",address});
  if(geo.error) throw new Error(geo.error+(geo.status?" ("+geo.status+")":""));
  const {lat,lng}=geo;
  const nearby=await placesCall({type:"nearby",lat,lng,placeType,keyword});
  if(nearby.error) throw new Error(nearby.error+(nearby.status?" ("+nearby.status+")":""));
  const places=nearby.results||[];
  const detailed=await Promise.all(
    places.slice(0,4).map(async p=>{
      try{
        const[det,drive]=await Promise.all([
          placesCall({type:"details",place_id:p.place_id}),
          getDriving(address,p.lat,p.lng),
        ]);
        const distLabel=drive?drive.distance+" ("+drive.duration+")":"";
        return{name:det.name||p.name,address:det.address||p.address,phone:det.phone||"",distance:distLabel};
      }catch{return{name:p.name,address:p.address,phone:"",distance:""};}
    })
  );
  return detailed;
}

const UTILS={
  AL:{gas:[{n:"Spire Alabama",p:"800-292-4008"}],elec:[{n:"Alabama Power",p:"800-888-2726"}],water:[]},
  AK:{gas:[{n:"Enstar Natural Gas",p:"907-334-7760"}],elec:[{n:"Golden Valley Electric",p:"907-452-1151"}],water:[]},
  AZ:{gas:[{n:"Southwest Gas",p:"877-860-6020"}],elec:[{n:"APS",p:"855-688-2437"},{n:"SRP",p:"602-236-8888"}],water:[]},
  AR:{gas:[{n:"CenterPoint Energy AR",p:"800-992-7552"}],elec:[{n:"Entergy Arkansas",p:"800-968-8243"}],water:[]},
  CA:{gas:[{n:"SoCalGas",p:"800-427-2200"},{n:"PG&E Gas",p:"800-743-5000"}],elec:[{n:"PG&E",p:"800-743-5000"},{n:"SCE",p:"800-611-1911"},{n:"SDG&E",p:"800-411-7343"}],water:[]},
  CO:{gas:[{n:"Xcel Energy Gas",p:"800-895-4999"}],elec:[{n:"Xcel Energy",p:"800-895-4999"},{n:"Black Hills Energy",p:"888-890-5554"}],water:[]},
  CT:{gas:[{n:"Eversource Gas CT",p:"800-989-0900"}],elec:[{n:"Eversource CT",p:"800-286-2000"},{n:"United Illuminating",p:"800-722-5584"}],water:[]},
  DE:{gas:[{n:"Chesapeake Utilities",p:"800-427-5454"}],elec:[{n:"Delmarva Power",p:"800-375-7117"}],water:[]},
  FL:{gas:[{n:"TECO Peoples Gas",p:"877-832-6747"}],elec:[{n:"FPL",p:"800-226-3545"},{n:"Duke Energy FL",p:"800-228-8485"}],water:[]},
  GA:{gas:[{n:"Atlanta Gas Light",p:"770-907-4231"}],elec:[{n:"Georgia Power",p:"888-660-5890"}],water:[]},
  HI:{gas:[{n:"The Gas Company Hawaii",p:"808-535-5933"}],elec:[{n:"Hawaiian Electric",p:"808-548-7311"}],water:[]},
  ID:{gas:[{n:"Intermountain Gas",p:"800-984-3163"}],elec:[{n:"Idaho Power",p:"208-388-2323"}],water:[]},
  IL:{gas:[{n:"Nicor Gas",p:"888-642-6748"},{n:"Peoples Gas IL",p:"866-556-6004"}],elec:[{n:"ComEd",p:"800-334-7661"},{n:"Ameren IL",p:"800-755-5000"}],water:[]},
  IN:{gas:[{n:"CenterPoint Energy IN",p:"800-227-1376"},{n:"NIPSCO",p:"800-634-3524"}],elec:[{n:"AES Indiana",p:"317-261-8222"},{n:"NIPSCO Electric",p:"800-464-2727"}],water:[]},
  IA:{gas:[{n:"MidAmerican Energy Gas",p:"888-427-5632"}],elec:[{n:"MidAmerican Energy",p:"888-427-5632"},{n:"Alliant Energy",p:"800-255-4268"}],water:[]},
  KS:{gas:[{n:"Kansas Gas Service",p:"800-794-4780"}],elec:[{n:"Evergy",p:"888-471-5275"}],water:[]},
  KY:{gas:[{n:"Atmos Energy KY",p:"800-543-8911"}],elec:[{n:"LG&E",p:"502-589-1444"},{n:"Duke Energy KY",p:"800-543-5599"}],water:[]},
  LA:{gas:[{n:"CenterPoint Energy LA",p:"800-477-0177"}],elec:[{n:"Entergy Louisiana",p:"800-968-8243"},{n:"Cleco",p:"800-622-6537"}],water:[]},
  ME:{gas:[{n:"Unitil Gas",p:"888-301-7700"}],elec:[{n:"Central Maine Power",p:"800-696-1000"},{n:"Versant Power",p:"855-516-1090"}],water:[]},
  MD:{gas:[{n:"Washington Gas",p:"844-927-3999"},{n:"BGE Gas",p:"800-685-0123"}],elec:[{n:"BGE",p:"800-685-0123"},{n:"Pepco",p:"202-833-7500"}],water:[]},
  MA:{gas:[{n:"National Grid Gas MA",p:"800-233-5325"},{n:"Eversource Gas MA",p:"800-592-2000"}],elec:[{n:"Eversource MA",p:"800-592-2000"},{n:"National Grid MA",p:"800-465-1212"}],water:[]},
  MI:{gas:[{n:"Consumers Energy Gas",p:"800-477-5050"},{n:"DTE Energy Gas",p:"800-477-4747"}],elec:[{n:"DTE Energy",p:"800-477-4747"},{n:"Consumers Energy",p:"800-477-5050"}],water:[]},
  MN:{gas:[{n:"CenterPoint Energy MN",p:"800-245-2377"}],elec:[{n:"Xcel Energy MN",p:"800-895-4999"}],water:[]},
  MS:{gas:[{n:"Spire Mississippi",p:"800-256-5400"}],elec:[{n:"Entergy Mississippi",p:"800-968-8243"}],water:[]},
  MO:{gas:[{n:"Spire MO",p:"800-582-1234"}],elec:[{n:"Ameren Missouri",p:"800-552-7583"},{n:"Evergy MO",p:"888-471-5275"}],water:[]},
  MT:{gas:[{n:"NorthWestern Energy Gas",p:"888-467-2669"}],elec:[{n:"NorthWestern Energy",p:"888-467-2669"}],water:[]},
  NE:{gas:[{n:"Black Hills Energy NE",p:"888-890-5554"}],elec:[{n:"OPPD",p:"402-536-4131"},{n:"Lincoln Electric System",p:"402-475-4211"}],water:[]},
  NV:{gas:[{n:"Southwest Gas NV",p:"877-860-6020"}],elec:[{n:"NV Energy",p:"775-834-4100"}],water:[]},
  NH:{gas:[{n:"Liberty Utilities Gas NH",p:"800-719-7280"}],elec:[{n:"Eversource NH",p:"800-662-7764"}],water:[]},
  NJ:{gas:[{n:"NJ Natural Gas",p:"800-221-0051"},{n:"PSE&G Gas",p:"800-880-7734"}],elec:[{n:"PSE&G",p:"800-436-7734"},{n:"JCP&L",p:"800-662-3115"}],water:[]},
  NM:{gas:[{n:"NM Gas Company",p:"888-664-2726"}],elec:[{n:"PNM",p:"888-342-5766"}],water:[]},
  NY:{gas:[{n:"ConEdison Gas",p:"800-752-6633"},{n:"National Grid NY Gas",p:"718-643-4050"}],elec:[{n:"ConEdison",p:"800-752-6633"},{n:"National Grid NY",p:"718-643-4050"},{n:"NYSEG",p:"800-572-1131"}],water:[]},
  NC:{gas:[{n:"Dominion Energy NC Gas",p:"877-776-2427"},{n:"Piedmont Natural Gas",p:"800-752-7504"}],elec:[{n:"Duke Energy NC",p:"800-777-9898"},{n:"Dominion Energy NC",p:"800-866-0882"}],water:[]},
  ND:{gas:[{n:"Montana-Dakota Utilities Gas",p:"800-638-3278"}],elec:[{n:"Montana-Dakota Utilities",p:"800-638-3278"},{n:"Otter Tail Power",p:"800-257-4044"}],water:[]},
  OH:{gas:[{n:"Dominion Energy Ohio",p:"800-362-7557"},{n:"Columbia Gas OH",p:"800-344-4077"}],elec:[{n:"AES Ohio",p:"800-433-8500"},{n:"FirstEnergy OH",p:"888-544-4877"},{n:"Duke Energy OH",p:"800-543-5599"}],water:[]},
  OK:{gas:[{n:"Oklahoma Natural Gas",p:"800-664-5463"}],elec:[{n:"OG&E",p:"405-272-9741"},{n:"PSO",p:"888-216-3523"}],water:[]},
  OR:{gas:[{n:"NW Natural Gas",p:"800-422-4012"}],elec:[{n:"Portland General Electric",p:"800-542-8818"},{n:"Pacific Power OR",p:"888-221-7070"}],water:[]},
  PA:{gas:[{n:"PECO Gas",p:"800-841-4141"},{n:"Peoples Gas PA",p:"800-764-0111"},{n:"Columbia Gas PA",p:"888-460-4332"}],elec:[{n:"PECO",p:"800-841-4141"},{n:"PPL Electric",p:"800-342-5775"}],water:[]},
  RI:{gas:[{n:"National Grid RI Gas",p:"800-640-1595"}],elec:[{n:"National Grid RI",p:"800-465-1212"}],water:[]},
  SC:{gas:[{n:"Dominion Energy SC Gas",p:"800-815-0083"},{n:"Piedmont Natural Gas SC",p:"800-752-7504"}],elec:[{n:"Duke Energy SC",p:"800-777-9898"}],water:[]},
  SD:{gas:[{n:"Black Hills Energy SD",p:"888-890-5554"}],elec:[{n:"Black Hills Energy SD",p:"888-890-5554"}],water:[]},
  TN:{gas:[{n:"Atmos Energy TN",p:"888-286-6700"}],elec:[{n:"TVA / local co-ops",p:"888-882-4211"},{n:"Nashville Electric",p:"615-736-6900"}],water:[]},
  TX:{gas:[{n:"Atmos Energy TX",p:"888-286-6700"},{n:"CenterPoint Energy TX Gas",p:"888-876-5786"}],elec:[{n:"Oncor",p:"888-313-4747"},{n:"CenterPoint Energy TX Electric",p:"713-207-2222"}],water:[]},
  UT:{gas:[{n:"Dominion Energy UT",p:"800-323-5517"}],elec:[{n:"Rocky Mountain Power",p:"888-221-7070"}],water:[]},
  VT:{gas:[{n:"Vermont Gas Systems",p:"802-863-4511"}],elec:[{n:"Green Mountain Power",p:"888-835-4672"}],water:[]},
  VA:{gas:[{n:"Washington Gas",p:"844-927-3999"},{n:"Columbia Gas VA",p:"800-543-8911"}],elec:[{n:"Dominion Energy VA",p:"866-366-4357"},{n:"Appalachian Power",p:"800-956-4237"}],water:[]},
  WA:{gas:[{n:"Puget Sound Energy Gas",p:"888-225-5773"},{n:"Avista Gas",p:"800-227-9187"}],elec:[{n:"Puget Sound Energy",p:"888-225-5773"},{n:"Seattle City Light",p:"206-684-3000"}],water:[]},
  WV:{gas:[{n:"Peoples Natural Gas",p:"800-764-0111"}],elec:[{n:"Appalachian Power",p:"800-956-4237"},{n:"Mon Power",p:"888-544-4877"}],water:[]},
  WI:{gas:[{n:"WPS",p:"800-450-7280"},{n:"We Energies Gas",p:"800-242-9137"}],elec:[{n:"We Energies",p:"800-242-9137"},{n:"WPS",p:"800-450-7280"}],water:[]},
  WY:{gas:[{n:"Black Hills Energy WY",p:"888-890-5554"}],elec:[{n:"Rocky Mountain Power WY",p:"888-221-7070"}],water:[]},
  DC:{gas:[{n:"Washington Gas DC",p:"844-927-3999"}],elec:[{n:"Pepco DC",p:"202-833-7500"}],water:[]},
};
function getUtils(s){return UTILS[s.trim().toUpperCase()]||{gas:[],elec:[],water:[]};}

const cH={background:NAV,padding:"18px 26px 16px",borderBottom:"3px solid "+RED};
const cT={fontFamily:"Georgia,serif",fontSize:"1.18rem",fontWeight:800,letterSpacing:"0.05em",textTransform:"uppercase",color:WHITE,margin:0};
const cS={fontSize:"0.75rem",color:"#7a9ac8",marginTop:4};
const cB={padding:"22px 26px 18px"};
const nR={display:"flex",justifyContent:"space-between",alignItems:"center",padding:"14px 26px",borderTop:"1px solid "+RULE,background:FILL};
const LBL={display:"block",fontSize:"0.58rem",fontWeight:700,letterSpacing:"0.14em",textTransform:"uppercase",color:LABEL,marginBottom:4};
const IB={width:"100%",border:"1.5px solid "+RULE,borderRadius:6,padding:"8px 11px",fontSize:"0.85rem",color:TEXT,background:FILL,outline:"none",boxSizing:"border-box",fontFamily:"inherit"};
const BP={background:RED,color:WHITE,border:"none",borderRadius:7,padding:"10px 24px",fontSize:"0.83rem",fontWeight:700,letterSpacing:"0.06em",textTransform:"uppercase",cursor:"pointer"};
const BS={background:"transparent",color:LABEL,border:"1.5px solid "+RULE,borderRadius:7,padding:"9px 20px",fontSize:"0.83rem",fontWeight:600,cursor:"pointer"};
const BA={background:"transparent",border:"1.5px dashed "+RULE,borderRadius:6,padding:"7px 14px",fontSize:"0.75rem",color:LABEL,cursor:"pointer",fontFamily:"inherit"};
const TH={background:STEEL,color:"#d0ddf0",fontSize:"0.52rem",fontWeight:700,letterSpacing:"0.12em",textTransform:"uppercase",padding:"5px 6px",textAlign:"left",border:"1px solid #1e3260"};
const TD={border:"1px solid "+RULE,padding:0};
const RN={background:ICE,color:STEEL,fontWeight:700,fontSize:"0.66rem",textAlign:"center",padding:"5px 6px",border:"1px solid "+RULE,width:26};

const STEPS=["Address","Family","ER","Urgent Care","Contacts","Pets","Utilities","Preview"];
const blankM=()=>({name:"",role:"",age:"",hair:"",eyes:"",mark:"",allergies:"",medications:"",conditions:""});
const blankP=()=>({name:"",breed:"",color:"",location:"",notes:""});

function Inp({label:lb,value,onChange,placeholder,style={}}){
  const[f,sF]=useState(false);
  return(
    <div>
      {lb&&<label style={LBL}>{lb}</label>}
      <input style={{...IB,...(f?{borderColor:BLUE,background:WHITE}:{}),...style}}
        value={value} onChange={e=>onChange(e.target.value)} placeholder={placeholder}
        onFocus={()=>sF(true)} onBlur={()=>sF(false)}/>
    </div>
  );
}

function Spinner({msg}){
  return(
    <div style={{textAlign:"center",padding:"44px 20px"}}>
      <div style={{width:44,height:44,border:"4px solid "+RULE,borderTopColor:RED,borderRadius:"50%",animation:"spin 0.9s linear infinite",margin:"0 auto 14px"}}/>
      <div style={{fontSize:"0.8rem",color:LABEL,animation:"pulse 1.5s ease-in-out infinite"}}>{msg}</div>
    </div>
  );
}

function SH({children}){
  return <div style={{background:NAV,color:WHITE,fontWeight:700,fontSize:"0.6rem",letterSpacing:"0.14em",textTransform:"uppercase",padding:"3px 20px 3px 9px",marginBottom:8,display:"inline-block",clipPath:"polygon(0 0,calc(100% - 7px) 0,100% 50%,calc(100% - 7px) 100%,0 100%)"}}>{children}</div>;
}

function OptCard({selected,onClick,disabled,children}){
  return(
    <div onClick={()=>!disabled&&onClick()} style={{border:"2px solid "+(selected?RED:RULE),borderRadius:8,padding:"11px 13px",cursor:disabled?"not-allowed":"pointer",background:selected?"#fff4f4":FILL,position:"relative",opacity:disabled?0.4:1,transition:"all .15s"}}>
      {selected&&<div style={{position:"absolute",top:8,right:10,width:18,height:18,borderRadius:"50%",background:RED,color:WHITE,display:"flex",alignItems:"center",justifyContent:"center",fontSize:11,fontWeight:700}}>‚úì</div>}
      {children}
    </div>
  );
}

function MC({children,bg=FILL,border=RULE,style={}}){return <div style={{border:"1.5px solid "+border,borderRadius:4,padding:"8px 10px",background:bg,...style}}>{children}</div>;}
function CL({children,color=BLUE}){return <div style={{fontSize:"0.5rem",fontWeight:700,letterSpacing:"0.14em",textTransform:"uppercase",color,borderBottom:"1px solid "+RULE,paddingBottom:3,marginBottom:6}}>{children}</div>;}
function F({lbl,val}){
  return(
    <div style={{display:"flex",flexDirection:"column",gap:2,marginBottom:5}}>
      <div style={{fontSize:"0.5rem",fontWeight:700,letterSpacing:"0.14em",textTransform:"uppercase",color:LABEL}}>{lbl}</div>
      <div style={{fontSize:"0.72rem",borderBottom:"1px solid "+RULE,paddingBottom:2,minHeight:15,color:val?TEXT:"#ccc",fontStyle:val?"normal":"italic"}}>{val||"‚Äî"}</div>
    </div>
  );
}

function ContactCard({title,data,onChange,accentColor}){
  const c=accentColor||BLUE;
  return(
    <div style={{border:"1.5px solid "+RULE,borderRadius:8,padding:"12px 13px",background:FILL}}>
      <div style={{fontSize:"0.56rem",fontWeight:700,letterSpacing:"0.16em",textTransform:"uppercase",color:c,borderBottom:"1px solid "+RULE,paddingBottom:4,marginBottom:9}}>{title}</div>
      <div style={{display:"flex",flexDirection:"column",gap:9}}>
        <Inp label="Name" value={data.name||""} onChange={v=>onChange("name",v)} placeholder="Full name"/>
        <Inp label="Phone" value={data.phone||""} onChange={v=>onChange("phone",v)} placeholder="(xxx) xxx-xxxx"/>
        <Inp label="Relationship / Notes" value={data.rel||""} onChange={v=>onChange("rel",v)} placeholder="e.g. Paternal grandfather"/>
      </div>
    </div>
  );
}

function AddressStep({data,setData}){
  const u=(k,v)=>setData(d=>({...d,[k]:v}));
  return(
    <div>
      <div style={cH}><h2 style={cT}>Home Address</h2><p style={cS}>Used to find your nearest ER, urgent care, and utility providers.</p></div>
      <div style={cB}>
        <div style={{marginBottom:13}}><Inp label="Street Address" value={data.street} onChange={v=>u("street",v)} placeholder="e.g. 1234 Jefferson Avenue"/></div>
        <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:11}}>
          <Inp label="City" value={data.city} onChange={v=>u("city",v)} placeholder="Charlottesville"/>
          <Inp label="State (2-letter)" value={data.state} onChange={v=>u("state",v)} placeholder="VA"/>
          <Inp label="Zip Code" value={data.zip} onChange={v=>u("zip",v)} placeholder="22901"/>
        </div>
      </div>
    </div>
  );
}

const FCOLS=["Full Name","Role","Age","Hair","Eyes","Defining Feature","Allergies","Medications","Condition"];
const FKEYS=["name","role","age","hair","eyes","mark","allergies","medications","conditions"];

function FamilyStep({members,setMembers}){
  const upd=(i,k,v)=>setMembers(ms=>ms.map((m,idx)=>idx===i?{...m,[k]:v}:m));
  return(
    <div>
      <div style={cH}><h2 style={cT}>Family Members</h2><p style={cS}>Add everyone who lives in or regularly stays at your home.</p></div>
      <div style={cB}>
        <div style={{overflowX:"auto"}}>
          <table style={{width:"100%",borderCollapse:"collapse",fontSize:"0.76rem"}}>
            <thead><tr><th style={{...TH,width:24}}>#</th>{FCOLS.map(c=><th key={c} style={TH}>{c}</th>)}<th style={TH}></th></tr></thead>
            <tbody>
              {members.map((m,i)=>(
                <tr key={i} style={{background:i%2===1?FILL:WHITE}}>
                  <td style={RN}>{i+1}</td>
                  {FKEYS.map(k=><td key={k} style={TD}><input className="tbl-input" value={m[k]} placeholder="‚Äî" onChange={e=>upd(i,k,e.target.value)}/></td>)}
                  <td style={{...TD,textAlign:"center",width:30}}>
                    {members.length>1&&<button onClick={()=>setMembers(ms=>ms.filter((_,idx)=>idx!==i))} style={{background:"transparent",border:"none",color:"#ccc",cursor:"pointer",fontSize:14}}>x</button>}
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
        <button style={{...BA,marginTop:11}} onClick={()=>setMembers(ms=>[...ms,blankM()])}>+ Add Family Member</button>
      </div>
    </div>
  );
}

function FacilityStep({title,subtitle,options,loading,errorMsg,selected,onSelect,multiMax,onToggle}){
  const multi=!!onToggle;
  return(
    <div>
      <div style={cH}><h2 style={cT}>{title}</h2><p style={cS}>{subtitle}</p></div>
      <div style={cB}>
        {loading
          ?<Spinner msg={"Searching Google Maps for nearby "+title.toLowerCase().replace(/[^a-z ]/gi,"")+"."}/>
          :options&&options.length>0
            ?<div style={{display:"flex",flexDirection:"column",gap:9}}>
              {options.map((o,i)=>{
                const sel=multi?selected.includes(i):selected===i;
                const dis=multi&&selected.length>=multiMax&&!sel;
                return(
                  <OptCard key={i} selected={sel} disabled={dis} onClick={()=>multi?onToggle(i):onSelect(i)}>
                    <div style={{fontWeight:700,fontSize:"0.86rem",color:NAV}}>{o.name}</div>
                    <div style={{fontSize:"0.72rem",color:LABEL,marginTop:2}}>{o.address}</div>
                    <div style={{display:"flex",gap:14,marginTop:3}}>
                      {o.phone&&<div style={{fontSize:"0.72rem",color:LABEL}}>{o.phone}</div>}
                      {o.distance&&<div style={{fontSize:"0.7rem",fontWeight:700,color:RED}}>üìç {o.distance}</div>}
                    </div>
                  </OptCard>
                );
              })}
            </div>
            :<div style={{background:"#fff8f8",border:"1.5px solid #f0c0c0",borderRadius:8,padding:"16px 18px"}}>
              <div style={{fontWeight:700,fontSize:"0.8rem",color:"#a01020",marginBottom:6}}>Search failed</div>
              <div style={{fontSize:"0.76rem",color:LABEL,marginBottom:4}}>{errorMsg||"No results found."}</div>
              <div style={{fontSize:"0.72rem",color:LABEL}}>You can continue and fill in details manually on the preview step.</div>
            </div>
        }
      </div>
    </div>
  );
}

function ContactsStep({contacts,setContacts}){
  const upd=useCallback((key,field,val)=>setContacts(c=>({...c,[key]:{...c[key],[field]:val}})),[setContacts]);
  const u1=useCallback((f,v)=>upd("fam1",f,v),[upd]);
  const u2=useCallback((f,v)=>upd("fam2",f,v),[upd]);
  const u3=useCallback((f,v)=>upd("neighbor",f,v),[upd]);
  return(
    <div>
      <div style={cH}><h2 style={cT}>Emergency Contacts</h2><p style={cS}>Who should be called if primary family members are unreachable?</p></div>
      <div style={cB}>
        <div style={{display:"flex",flexDirection:"column",gap:11}}>
          <ContactCard title="Family Contact 1" data={contacts.fam1||{}} onChange={u1}/>
          <ContactCard title="Family Contact 2" data={contacts.fam2||{}} onChange={u2}/>
          <ContactCard title="Neighbor / Local Contact" data={contacts.neighbor||{}} onChange={u3} accentColor={STEEL}/>
        </div>
        <div style={{marginTop:18}}>
          <SH>Rally Points &amp; Family Password</SH>
          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:11,marginTop:6}}>
            <Inp label="Primary Rally Point" value={contacts.rally1||""} onChange={v=>setContacts(c=>({...c,rally1:v}))} placeholder="e.g. Neighbor mailbox across street"/>
            <Inp label="Alternate Rally Point" value={contacts.rally2||""} onChange={v=>setContacts(c=>({...c,rally2:v}))} placeholder="e.g. Corner of Oak St & Main"/>
            <Inp label="Family Password" value={contacts.password||""} onChange={v=>setContacts(c=>({...c,password:v}))} placeholder="e.g. SYCAMORE"/>
          </div>
        </div>
      </div>
    </div>
  );
}

function PetsStep({pets,setPets}){
  const upd=(i,k,v)=>setPets(ps=>ps.map((p,idx)=>idx===i?{...p,[k]:v}:p));
  return(
    <div>
      <div style={cH}><h2 style={cT}>Pets</h2><p style={cS}>First responders search for pets. Skip if none.</p></div>
      <div style={cB}>
        {pets.length===0&&<div style={{textAlign:"center",padding:"14px 0 18px",color:LABEL,fontSize:"0.82rem"}}>No pets added yet.</div>}
        {pets.map((p,i)=>(
          <div key={i} style={{border:"1.5px solid "+RULE,borderRadius:8,padding:"12px 13px",background:FILL,marginBottom:9,position:"relative"}}>
            <div style={{fontSize:"0.56rem",fontWeight:700,letterSpacing:"0.16em",textTransform:"uppercase",color:STEEL,marginBottom:9}}>Pet {i+1}</div>
            <button onClick={()=>setPets(ps=>ps.filter((_,idx)=>idx!==i))} style={{position:"absolute",top:8,right:10,background:"transparent",border:"none",color:"#ccc",cursor:"pointer",fontSize:14}}>x</button>
            <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:9,marginBottom:9}}>
              <Inp label="Name" value={p.name} onChange={v=>upd(i,"name",v)} placeholder="e.g. Ranger"/>
              <Inp label="Species / Breed" value={p.breed} onChange={v=>upd(i,"breed",v)} placeholder="e.g. Golden Retriever"/>
              <Inp label="Color / Markings" value={p.color} onChange={v=>upd(i,"color",v)} placeholder="e.g. Golden, white chest"/>
            </div>
            <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:9}}>
              <Inp label="Normally Located" value={p.location} onChange={v=>upd(i,"location",v)} placeholder="e.g. Crate in laundry room"/>
              <Inp label="Special Notes" value={p.notes} onChange={v=>upd(i,"notes",v)} placeholder="e.g. Friendly, will not bite"/>
            </div>
          </div>
        ))}
        <button style={BA} onClick={()=>setPets(ps=>[...ps,blankP()])}>+ Add Pet</button>
      </div>
    </div>
  );
}

const UTIL_TYPES=[
  {key:"gas",label:"Gas",emoji:"üî•",color:"#8a4010",bg:"#fff8f0",border:"#e8c090"},
  {key:"elec",label:"Electric",emoji:"‚ö°",color:"#6a6010",bg:"#f8f8f0",border:"#d8d090"},
  {key:"water",label:"Water",emoji:"üíß",color:"#1a3a7a",bg:"#f0f6ff",border:"#a0b8e0"},
];

function UtilitiesStep({utilData,selected,onSelect,shutoffs,onShutoff,manualUtils,onManual}){
  return(
    <div>
      <div style={cH}><h2 style={cT}>Utility Providers &amp; Shutoffs</h2><p style={cS}>Providers are pre-filled based on your state. Select yours and add shutoff locations.</p></div>
      <div style={cB}>
        {UTIL_TYPES.map(t=>(
          <div key={t.key} style={{marginBottom:20}}>
            <SH>{t.emoji} {t.label}</SH>
            <div style={{display:"flex",flexDirection:"column",gap:7,marginBottom:9}}>
              <OptCard selected={selected[t.key]==="na"} onClick={()=>onSelect(t.key,"na")}>
                <div style={{fontWeight:700,fontSize:"0.84rem",color:LABEL}}>N/A - We don't have {t.label.toLowerCase()}</div>
              </OptCard>
              {(utilData[t.key]||[]).map((o,i)=>(
                <OptCard key={i} selected={selected[t.key]===i} onClick={()=>onSelect(t.key,i)}>
                  <div style={{fontWeight:700,fontSize:"0.84rem",color:NAV}}>{o.n}</div>
                  {o.p&&<div style={{fontSize:"0.72rem",color:LABEL,marginTop:2}}>Emergency: {o.p}</div>}
                </OptCard>
              ))}
              {(utilData[t.key]||[]).length===0&&selected[t.key]!=="na"&&(
                <div style={{border:"1.5px solid "+RULE,borderRadius:8,padding:"11px 13px",background:FILL}}>
                  <div style={{fontSize:"0.7rem",color:LABEL,marginBottom:9}}>No providers found for your state ‚Äî enter manually:</div>
                  <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:9}}>
                    <Inp label="Provider Name" value={manualUtils[t.key]?.name||""} onChange={v=>onManual(t.key,"name",v)} placeholder={"e.g. City of Charlottesville Water"}/>
                    <Inp label="Emergency Phone" value={manualUtils[t.key]?.phone||""} onChange={v=>onManual(t.key,"phone",v)} placeholder="e.g. 434-970-3211"/>
                  </div>
                </div>
              )}
            </div>
            {selected[t.key]!=="na"&&(
              <Inp label={t.label+" Shutoff Location"} value={shutoffs[t.key]||""} onChange={v=>onShutoff(t.key,v)}
                placeholder={t.key==="gas"?"e.g. Left side of house":t.key==="elec"?"e.g. Basement, north wall":"e.g. Basement near water heater"}/>
            )}
          </div>
        ))}
      </div>
    </div>
  );
}

function PrintSheet({address,members,er,urgentCares,contacts,pets,utilData,selectedUtils,shutoffs,manualUtils}){
  const gP=k=>{const s=selectedUtils[k];if(s==="na"||s===null)return null;const auto=(utilData[k]||[])[s]?.p;return auto||manualUtils[k]?.phone||null;};
  const gN=k=>{const s=selectedUtils[k];if(s==="na"||s===null)return null;const auto=(utilData[k]||[])[s]?.n;return auto||manualUtils[k]?.name||null;};
  return(
    <div id="printable-sheet" style={{border:"1px solid "+RULE,borderTop:"5px solid "+NAV,background:WHITE,fontSize:"11px"}}>
      <div style={{background:NAV,padding:"11px 20px",display:"flex",alignItems:"center",justifyContent:"space-between"}}>
        <div style={{display:"flex",flexDirection:"column",alignItems:"flex-start"}}>
          <img src={LOGO_SRC} alt="Safe Steps" style={{height:42,display:"block",borderRadius:4,padding:"3px 7px",background:WHITE}}/>
          <div style={{fontSize:"0.46rem",letterSpacing:"0.18em",textTransform:"uppercase",color:"#7a9ac8",marginTop:5}}>Veteran-Built Home Preparedness</div>
        </div>
        <div style={{textAlign:"right"}}>
          <div style={{fontFamily:"Georgia,serif",fontSize:"1.05rem",fontWeight:800,letterSpacing:"0.05em",textTransform:"uppercase",color:WHITE}}>Family Emergency Sheet</div>
          <span style={{background:RED,color:WHITE,fontSize:"0.44rem",fontWeight:700,letterSpacing:"0.2em",textTransform:"uppercase",padding:"2px 9px",borderRadius:20,display:"inline-block",marginTop:3}}>Post on Refrigerator</span>
        </div>
      </div>
      <div style={{padding:"13px 20px 16px"}}>
        <div style={{background:ICE,border:"1.5px solid "+RULE,borderLeft:"5px solid "+RED,padding:"7px 11px",marginBottom:11,display:"flex",alignItems:"center",gap:9}}>
          <span style={{fontSize:"1.1rem",opacity:0.6}}>üìç</span>
          <div style={{flex:1}}>
            <div style={{fontSize:"0.46rem",fontWeight:700,letterSpacing:"0.2em",textTransform:"uppercase",color:RED,marginBottom:4}}>Home Address</div>
            <div style={{display:"grid",gridTemplateColumns:"2fr 1fr 0.5fr 0.6fr",gap:7}}>
              <F lbl="Street Address" val={address.street}/><F lbl="City" val={address.city}/><F lbl="State" val={address.state}/><F lbl="Zip" val={address.zip}/>
            </div>
          </div>
        </div>
        <div style={{marginBottom:11}}>
          <SH>Family Members</SH>
          <div style={{overflowX:"auto"}}>
            <table style={{width:"100%",borderCollapse:"collapse",fontSize:"0.65rem"}}>
              <thead><tr>{["#","Full Name","Role","Age","Hair","Eyes","Defining Feature / Mark","Allergies","Medications","Disability / Medical Condition"].map(h=><th key={h} style={{...TH,fontSize:"0.48rem"}}>{h}</th>)}</tr></thead>
              <tbody>{members.filter(m=>m.name).map((m,i)=>(
                <tr key={i} style={{background:i%2===1?FILL:WHITE}}>
                  <td style={{...RN,fontSize:"0.58rem"}}>{i+1}</td>
                  {["name","role","age","hair","eyes","mark","allergies","medications","conditions"].map(k=><td key={k} style={{...TD,padding:"3px 5px",fontSize:"0.65rem"}}>{m[k]||"‚Äî"}</td>)}
                </tr>
              ))}</tbody>
            </table>
          </div>
        </div>
        <div style={{marginBottom:11}}>
          <SH>Nearest Medical Facilities</SH>
          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:7}}>
            <MC bg="#fff4f4" border="#e0a0a0"><CL color="#a01020">üöë Emergency Room</CL><F lbl="Name" val={er?.name}/><F lbl="Address" val={er?.address}/><F lbl="Phone" val={er?.phone}/></MC>
            {[0,1].map(i=><MC key={i}><CL>‚ûï Urgent Care {i+1}</CL><F lbl="Name" val={urgentCares[i]?.name}/><F lbl="Address" val={urgentCares[i]?.address}/><F lbl="Phone" val={urgentCares[i]?.phone}/></MC>)}
          </div>
        </div>
        <div style={{marginBottom:11}}>
          <SH>Emergency Contacts</SH>
          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:7}}>
            {[{k:"fam1",lb:"Family Contact 1",c:BLUE},{k:"fam2",lb:"Family Contact 2",c:BLUE},{k:"neighbor",lb:"Neighbor / Local",c:STEEL}].map(({k,lb,c})=>(
              <MC key={k}><CL color={c}>{lb}</CL><F lbl="Name" val={contacts[k]?.name}/><F lbl="Phone" val={contacts[k]?.phone}/><F lbl="Relationship" val={contacts[k]?.rel}/></MC>
            ))}
          </div>
        </div>
        {pets.filter(p=>p.name).length>0&&(
          <div style={{marginBottom:11}}>
            <SH>Pets</SH>
            <table style={{width:"100%",borderCollapse:"collapse",fontSize:"0.65rem"}}>
              <thead><tr>{["#","Name","Species / Breed","Color / Markings","Normally Located","Special Notes"].map(h=><th key={h} style={{...TH,fontSize:"0.48rem"}}>{h}</th>)}</tr></thead>
              <tbody>{pets.filter(p=>p.name).map((p,i)=>(
                <tr key={i} style={{background:i%2===1?FILL:WHITE}}>
                  <td style={{...RN,fontSize:"0.58rem"}}>{i+1}</td>
                  {["name","breed","color","location","notes"].map(k=><td key={k} style={{...TD,padding:"3px 5px"}}>{p[k]||"‚Äî"}</td>)}
                </tr>
              ))}</tbody>
            </table>
          </div>
        )}
        <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:11,marginBottom:11}}>
          <div>
            <SH>Utility Shutoffs</SH>
            <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:6}}>
              {[{key:"gas",lb:"üî• Gas Meter",c:"#8a4010",bg:"#fff8f0",b:"#e8c090"},{key:"elec",lb:"‚ö° Electrical Panel",c:"#6a6010",bg:"#f8f8f0",b:"#d8d090"},{key:"water",lb:"üíß Water Main",c:"#1a3a7a",bg:"#f0f6ff",b:"#a0b8e0"}].map(u=>(
                <MC key={u.key} bg={u.bg} border={u.b}><CL color={u.c}>{u.lb}</CL>
                  {selectedUtils[u.key]==="na"?<div style={{fontSize:"0.68rem",color:LABEL,fontStyle:"italic"}}>No {u.key==="elec"?"electricity":u.key}</div>:<F lbl="Location" val={shutoffs[u.key]}/>}
                </MC>
              ))}
            </div>
          </div>
          <div>
            <SH>Important Phone Numbers</SH>
            <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:6}}>
              <MC bg="#fff8f8" border="#f0c0c0"><CL color="#a01020">‚ò£ Poison Control</CL><div style={{fontWeight:700,color:RED,fontSize:"0.76rem"}}>(800) 222-1222</div></MC>
              {[{key:"gas",lb:"üî• Gas Emergency",c:"#8a4010",bg:"#fff8f0",b:"#e8c090"},{key:"elec",lb:"‚ö° Power Outage",c:"#6a6010",bg:"#f8f8f0",b:"#d8d090"}].map(u=>(
                <MC key={u.key} bg={u.bg} border={u.b}><CL color={u.c}>{u.lb}</CL>
                  {selectedUtils[u.key]==="na"?<div style={{fontSize:"0.66rem",color:LABEL,fontStyle:"italic"}}>N/A</div>
                  :<><div style={{fontWeight:700,fontSize:"0.76rem",color:u.c}}>{gP(u.key)||"‚Äî"}</div><div style={{fontSize:"0.58rem",color:LABEL}}>{gN(u.key)||""}</div></>}
                </MC>
              ))}
            </div>
          </div>
        </div>
        <div>
          <SH>Additional Info</SH>
          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:7}}>
            <MC bg="#f0f8f0" border="#a0c8a0" style={{display:"flex",alignItems:"center",gap:7}}>
              <span style={{fontSize:"1.2rem",opacity:0.55,flexShrink:0}}>üè†</span>
              <div style={{flex:1}}><CL color="#2a6040">Primary Rally Point</CL><F lbl="Location" val={contacts.rally1}/></div>
            </MC>
            <MC bg="#f6f8f0" border="#b8c8a0" style={{display:"flex",alignItems:"center",gap:7}}>
              <span style={{fontSize:"1.2rem",opacity:0.55,flexShrink:0}}>üå≤</span>
              <div style={{flex:1}}><CL color="#4a6030">Alternate Rally Point</CL><F lbl="Location" val={contacts.rally2}/></div>
            </MC>
            <MC bg="#fffaf0" border="#e8d8a0"><CL color="#7a5a10">üîí Family Password</CL>
              <div style={{fontSize:"0.9rem",fontWeight:700,color:"#5a3a08",letterSpacing:"0.1em",marginTop:3}}>{contacts.password||"‚Äî"}</div>
            </MC>
          </div>
        </div>
      </div>
      <div style={{background:NAV,padding:"6px 20px",display:"flex",justifyContent:"space-between",alignItems:"center"}}>
        <div>
          <div style={{fontSize:"0.46rem",color:"#5a7aaa"}}>Prepared by Safe Steps | Your Trusted Partner in Family Protection</div>
          <div style={{fontWeight:700,fontSize:"0.62rem",color:"#7a9ac8",letterSpacing:"0.08em"}}>safestepsplans.com</div>
        </div>
        <div style={{fontSize:"0.46rem",color:"#5a7aaa"}}>Last Updated: {new Date().toLocaleDateString()}</div>
      </div>
    </div>
  );
}

function PreviewStep(props){
  const openPrint=()=>{
    const enc=v=>encodeURIComponent(JSON.stringify(v));
    const params=[
      "address="+enc(address),
      "members="+enc(members),
      "er="+enc(erSelected!==null?erOptions?.[erSelected]:null),
      "uc="+enc(ucSelected.map(i=>ucOptions?.[i])),
      "contacts="+enc(contacts),
      "pets="+enc(pets),
      "shutoffs="+enc(shutoffs),
      "selUtils="+enc(selectedUtils),
      "utilData="+enc(utilData),
      "manUtils="+enc(manualUtils),
    ].join("&");
    window.open("https://jacklimongelli.github.io/safesteps-wizard/safesteps-sheet.html?"+params,"_blank");
  };
  return(
    <div>
      <div style={cH}><h2 style={cT}>Preview Your Emergency Sheet</h2><p style={cS}>Review below, then click the button to print or save as PDF.</p></div>
      <div style={cB}>
        <div style={{textAlign:"center",marginBottom:16}}>
          <button style={{...BP,fontSize:"1rem",padding:"12px 32px"}} onClick={openPrint}>
            üñ® Print / Save as PDF
          </button>
          <div style={{fontSize:"0.7rem",color:LABEL,marginTop:7}}>Opens in a new tab ‚Äî use your browser's print dialog to save as PDF</div>
        </div>
        <PrintSheet {...props}/>
      </div>
    </div>
  );
}

function App(){
  const[step,setStep]=useState(0);
  const[address,setAddress]=useState({street:"",city:"",state:"",zip:""});
  const[members,setMembers]=useState([blankM(),blankM()]);
  const[contacts,setContacts]=useState({fam1:{},fam2:{},neighbor:{},rally1:"",rally2:"",password:""});
  const[pets,setPets]=useState([]);
  const[erOptions,setErOptions]=useState(null);
  const[erLoading,setErLoading]=useState(false);
  const[erSelected,setErSelected]=useState(null);
  const[erError,setErError]=useState("");
  const[ucOptions,setUcOptions]=useState(null);
  const[ucLoading,setUcLoading]=useState(false);
  const[ucSelected,setUcSelected]=useState([]);
  const[ucError,setUcError]=useState("");
  const[utilData,setUtilData]=useState({gas:[],elec:[],water:[]});
  const[selectedUtils,setSelectedUtils]=useState({gas:null,elec:null,water:null});
  const[shutoffs,setShutoffs]=useState({gas:"",elec:"",water:""});
  const[manualUtils,setManualUtils]=useState({gas:{name:"",phone:""},elec:{name:"",phone:""},water:{name:"",phone:""}});
  const onManual=(t,field,val)=>setManualUtils(u=>({...u,[t]:{...u[t],[field]:val}}));

  const addr=[address.street,address.city,address.state,address.zip].filter(Boolean).join(", ");

  const loadER=useCallback(async()=>{
    if(erLoading||erOptions)return;
    setErLoading(true);setErError("");
    try{
      const results=await searchNearby(addr,"hospital","emergency room");
      setErOptions(results.length>0?results.slice(0,3):null);
      if(!results.length)setErError("Google Maps returned no hospitals near this address.");
    }catch(e){
      setErOptions(null);
      setErError(e.message||"Unknown error");
    }
    setErLoading(false);
  },[addr,erLoading,erOptions]);

  const loadUC=useCallback(async()=>{
    if(ucLoading||ucOptions)return;
    setUcLoading(true);setUcError("");
    try{
      const results=await searchNearby(addr,"doctor","urgent care");
      setUcOptions(results.length>0?results.slice(0,4):null);
      if(!results.length)setUcError("Google Maps returned no urgent care near this address.");
    }catch(e){
      setUcOptions(null);
      setUcError(e.message||"Unknown error");
    }
    setUcLoading(false);
  },[addr,ucLoading,ucOptions]);

  const canNext=()=>{
    if(step===0)return address.street&&address.city&&address.state;
    if(step===1)return members.some(m=>m.name);
    return true;
  };

  const goNext=()=>{
    const n=step+1;setStep(n);
    if(n===2)loadER();
    if(n===3)loadUC();
    if(n===6)setUtilData(getUtils(address.state));
  };

  const er=erSelected!==null?erOptions?.[erSelected]:null;
  const urgentCares=ucSelected.map(i=>ucOptions?.[i]);

  const panels=[
    <AddressStep data={address} setData={setAddress}/>,
    <FamilyStep members={members} setMembers={setMembers}/>,
    <FacilityStep title="üöë Emergency Room" subtitle="Select the nearest emergency room to your home."
      options={erOptions} loading={erLoading} errorMsg={erError} selected={erSelected} onSelect={setErSelected}/>,
    <FacilityStep title="‚ûï Urgent Care" subtitle="Select up to 2 urgent care centers near your home."
      options={ucOptions} loading={ucLoading} errorMsg={ucError} selected={ucSelected} multiMax={2}
      onToggle={i=>setUcSelected(s=>s.includes(i)?s.filter(x=>x!==i):[...s,i])}/>,
    <ContactsStep contacts={contacts} setContacts={setContacts}/>,
    <PetsStep pets={pets} setPets={setPets}/>,
    <UtilitiesStep utilData={utilData} selected={selectedUtils}
      onSelect={(t,i)=>setSelectedUtils(u=>({...u,[t]:i}))}
      shutoffs={shutoffs} onShutoff={(t,v)=>setShutoffs(u=>({...u,[t]:v}))}
      manualUtils={manualUtils} onManual={onManual}/>,
    <PreviewStep address={address} members={members} er={er} urgentCares={urgentCares}
      contacts={contacts} pets={pets} utilData={utilData} selectedUtils={selectedUtils} shutoffs={shutoffs} manualUtils={manualUtils}/>,
  ];

  return(
    <div style={{minHeight:"100vh",background:"linear-gradient(135deg,#0b1e3d 0%,#1a3a6b 100%)",fontFamily:"'Inter',-apple-system,sans-serif",padding:"24px 12px 56px",color:TEXT}}>
      <div style={{textAlign:"center",marginBottom:16}}>
        <div style={{fontWeight:900,fontSize:"1.4rem",color:WHITE,letterSpacing:"0.04em",textTransform:"uppercase"}}>Safe<span style={{color:RED}}>Steps</span></div>
        <div style={{fontSize:"0.52rem",letterSpacing:"0.2em",textTransform:"uppercase",color:"rgba(255,255,255,0.38)",marginTop:3}}>Family Emergency Sheet Builder</div>
      </div>
      <div style={{maxWidth:760,margin:"0 auto 18px",background:"rgba(255,255,255,0.07)",borderRadius:10,padding:"16px 18px 0"}}>
        <div style={{display:"flex",alignItems:"flex-start",paddingBottom:16}}>
          {STEPS.map((st,i)=>(
            <div key={i} style={{display:"flex",alignItems:"center",flex:1}}>
              <div style={{display:"flex",flexDirection:"column",alignItems:"center",width:44,flexShrink:0,cursor:i<step?"pointer":"default"}} onClick={()=>i<step&&setStep(i)}>
                <div style={{width:26,height:26,borderRadius:"50%",background:i<step?RED:i===step?WHITE:"rgba(255,255,255,0.12)",border:"2px solid "+(i<step?RED:i===step?WHITE:"rgba(255,255,255,0.18)"),display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:700,color:i<step?WHITE:i===step?NAV:"rgba(255,255,255,0.35)",transition:"all .25s"}}>
                  {i<step?"‚úì":i+1}
                </div>
                <div style={{fontSize:"0.44rem",fontWeight:600,letterSpacing:"0.07em",textTransform:"uppercase",color:i<step?"rgba(255,255,255,0.8)":i===step?WHITE:"rgba(255,255,255,0.28)",marginTop:4,textAlign:"center",whiteSpace:"nowrap"}}>{st}</div>
              </div>
              {i<STEPS.length-1&&<div style={{flex:1,height:2,background:i<step?RED:"rgba(255,255,255,0.1)",marginTop:-13,transition:"background .25s"}}/>}
            </div>
          ))}
        </div>
      </div>
      <div style={{maxWidth:760,margin:"0 auto",background:WHITE,borderRadius:12,boxShadow:"0 20px 60px rgba(0,0,0,0.28)",overflow:"hidden"}}>
        {panels[step]}
        <div style={nR}>
          <div>{step>0&&<button style={BS} onClick={()=>setStep(s=>s-1)}>Back</button>}</div>
          <div style={{display:"flex",gap:9,alignItems:"center"}}>
            <span style={{fontSize:"0.68rem",color:LABEL}}>Step {step+1} of {STEPS.length}</span>
            {step<STEPS.length-1
              ?<button style={{...BP,opacity:canNext()?1:0.4,cursor:canNext()?"pointer":"not-allowed"}} onClick={()=>canNext()&&goNext()}>
                {step===0?"Find Nearby Facilities":step===1?"Find Emergency Rooms":"Next"}
              </button>
              :<button style={BP} onClick={()=>{
                const w=window.open("","_blank");
                const el=document.getElementById("printable-sheet");
                w.document.write("<html><head><title>Safe Steps Emergency Sheet</title><style>*{box-sizing:border-box;margin:0;padding:0}body{font-family:Inter,-apple-system,sans-serif}</style></head><body>"+el.innerHTML+"</body></html>");
                w.document.close();
                w.focus();
                setTimeout(()=>w.print(),500);
              }}>Print / Save as PDF</button>
            }
          </div>
        </div>
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>