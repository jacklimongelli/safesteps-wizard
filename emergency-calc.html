<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emergency Response Time Calculator | Safe Steps</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --navy:      #1B2F4E;
            --navy-mid:  #2C4A72;
            --gold:      #C8963E;
            --bg:        #F7F6F3;
            --white:     #FFFFFF;
            --border:    #E4E0D9;
            --text:      #1A1A1A;
            --text-mid:  #4A5568;
            --text-light:#8896A6;
            --red-soft:  #C0392B;
            --amber:     #D4730A;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }

        /* ── DEMO BANNER ── */

        /* ── HERO ── */
        .hero {
            background: var(--navy);
            padding: 48px 32px 44px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .hero::after {
            content: '';
            position: absolute;
            bottom: 0; left: 0; right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent 0%, var(--gold) 40%, var(--gold) 60%, transparent 100%);
            opacity: 0.6;
        }
        .hero-eyebrow {
            display: inline-flex;
            align-items: center;
            gap: 7px;
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 2.5px;
            text-transform: uppercase;
            color: var(--gold);
            margin-bottom: 18px;
        }
        .hero-eyebrow::before,
        .hero-eyebrow::after {
            content: '';
            display: block;
            width: 24px;
            height: 1px;
            background: var(--gold);
            opacity: 0.5;
        }
        .hero h1 {
            font-family: 'Playfair Display', serif;
            font-size: 32px;
            font-weight: 700;
            color: #FFFFFF;
            line-height: 1.25;
            margin-bottom: 14px;
            letter-spacing: -0.3px;
        }
        .hero-sub {
            font-size: 15px;
            font-weight: 300;
            color: #90A8C4;
            line-height: 1.7;
            max-width: 440px;
            margin: 0 auto;
        }

        /* ── INPUT PANEL ── */
        .input-panel {
            background: var(--white);
            border-bottom: 1px solid var(--border);
            padding: 24px 32px;
        }
        .input-label {
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 1.8px;
            text-transform: uppercase;
            color: var(--text-light);
            margin-bottom: 10px;
        }
        .input-row { display: flex; gap: 10px; }
        #address-input {
            flex: 1;
            padding: 13px 18px;
            border: 1.5px solid var(--border);
            background: var(--bg);
            font-family: 'Outfit', sans-serif;
            font-size: 14px;
            font-weight: 400;
            color: var(--text);
            outline: none;
            border-radius: 4px;
            transition: border-color 0.2s, background 0.2s;
        }
        #address-input::placeholder { color: #B0BBC8; }
        /* Google Places autocomplete dropdown styling */
        .pac-container {
            font-family: 'Outfit', sans-serif;
            border: 1px solid var(--border);
            border-top: none;
            border-radius: 0 0 4px 4px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            margin-top: -1px;
        }
        .pac-item {
            padding: 10px 16px;
            font-size: 13px;
            color: var(--text);
            cursor: pointer;
            border-top: 1px solid var(--rule);
            line-height: 1.5;
        }
        .pac-item:hover { background: var(--bg); }
        .pac-item-query { font-weight: 500; color: var(--text); }
        .pac-matched { font-weight: 600; color: var(--navy); }
        .pac-icon { display: none; }
        #address-input:focus {
            border-color: var(--navy);
            background: var(--white);
        }
        #search-btn {
            background: var(--navy);
            color: white;
            border: none;
            padding: 13px 24px;
            font-family: 'Outfit', sans-serif;
            font-size: 13px;
            font-weight: 600;
            letter-spacing: 0.5px;
            cursor: pointer;
            border-radius: 4px;
            white-space: nowrap;
            transition: background 0.2s, transform 0.1s;
        }
        #search-btn:hover { background: var(--navy-mid); }
        #search-btn:active { transform: scale(0.98); }
        #search-btn:disabled { opacity: 0.45; cursor: not-allowed; transform: none; }

        /* ── LOADING ── */
        .loading { display: none; padding: 52px 24px; text-align: center; }
        .loading.active { display: block; }
        .loading-dots {
            display: flex;
            justify-content: center;
            gap: 6px;
            margin-bottom: 20px;
        }
        .loading-dot {
            width: 8px; height: 8px;
            background: var(--navy);
            border-radius: 50%;
            opacity: 0.3;
            animation: pulse 1.2s ease-in-out infinite;
        }
        .loading-dot:nth-child(2) { animation-delay: 0.2s; }
        .loading-dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes pulse { 0%,80%,100%{opacity:0.2;transform:scale(0.8)} 40%{opacity:1;transform:scale(1)} }
        .loading-label {
            font-size: 13px;
            font-weight: 400;
            color: var(--text-light);
            letter-spacing: 0.3px;
        }

        /* ── ERROR ── */
        .error-msg {
            display: none;
            margin: 20px 32px;
            padding: 14px 18px;
            background: #FEF2F2;
            border-left: 3px solid var(--red-soft);
            font-size: 13px;
            color: #922B21;
            border-radius: 0 4px 4px 0;
            line-height: 1.6;
        }
        .error-msg.active { display: block; }

        /* ── RESULTS ── */
        .results { display: none; }
        .results.active { display: block; }

        /* address pill */
        .address-bar {
            padding: 12px 32px;
            background: var(--white);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .address-pin {
            width: 6px; height: 6px;
            background: var(--gold);
            border-radius: 50%;
            flex-shrink: 0;
        }
        .address-text {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-mid);
            letter-spacing: 0.2px;
        }

        /* ── TWO COLUMNS ── */
        .columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
        }
        @media (max-width: 620px) { .columns { grid-template-columns: 1fr; } }

        .col {
            padding: 28px 28px 24px;
            background: var(--bg);
        }
        .col:first-child {
            border-right: 1px solid var(--border);
            background: var(--white);
        }
        .col:last-child { background: var(--bg); }
        @media (max-width: 620px) {
            .col:first-child { border-right: none; border-bottom: 1px solid var(--border); }
        }

        /* col heading */
        .col-heading {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }
        .col-heading-icon {
            width: 34px; height: 34px;
            background: var(--navy);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }
        .col-heading-text {}
        .col-heading-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 1px;
        }
        .col-heading-sub {
            font-size: 11px;
            color: var(--text-light);
            font-weight: 400;
        }

        /* ── STATION ROWS ── */
        .station-list { display: flex; flex-direction: column; gap: 6px; margin-bottom: 20px; }

        .station-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 12px 14px;
            background: var(--bg);
            border: 1.5px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.18s;
        }
        .col:first-child .station-item { background: #F7F6F3; }
        .station-item:hover { border-color: #C8D5E8; }
        .station-item.selected {
            border-color: var(--navy);
            background: #EEF3FA;
        }
        .col:first-child .station-item.selected { background: #EEF3FA; }

        .station-selector {
            width: 18px; height: 18px;
            border-radius: 50%;
            border: 2px solid #C8D5E8;
            flex-shrink: 0;
            margin-top: 2px;
            position: relative;
            transition: all 0.15s;
        }
        .station-item.selected .station-selector {
            border-color: var(--navy);
            background: var(--navy);
        }
        .station-item.selected .station-selector::after {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 6px; height: 6px;
            background: white;
            border-radius: 50%;
        }

        .station-item-body { flex: 1; min-width: 0; }
        .station-item-name {
            font-size: 13px;
            font-weight: 500;
            color: var(--text);
            line-height: 1.4;
            margin-bottom: 3px;
        }
        .station-item-address {
            font-size: 11px;
            color: var(--text-light);
            font-weight: 400;
            margin-bottom: 6px;
            line-height: 1.4;
        }

        .pill-row { display: flex; flex-wrap: wrap; gap: 5px; align-items: center; }
        .pill {
            font-size: 10px;
            font-weight: 600;
            letter-spacing: 0.3px;
            padding: 2px 9px;
            border-radius: 20px;
        }
        .pill-career    { background: #E6F5EC; color: #1E7A3A; }
        .pill-volunteer { background: #FFF3E0; color: #B45309; }
        .pill-unknown   { background: #F0F4F8; color: #64748B; }
        .pill-town      { background: #E8EFF9; color: #2653A3; }
        .pill-outside   { background: #F0F4F8; color: #64748B; }
        .pill-source    { background: #F0F4F8; color: #64748B; }
        .pill-dist      { font-size: 10px; color: var(--text-light); font-weight: 400; }

        /* ── READOUT CARD ── */
        .readout-card {
            border: 1.5px solid var(--border);
            border-radius: 10px;
            overflow: hidden;
            background: var(--white);
        }
        .readout-top {
            background: var(--navy);
            padding: 14px 18px;
        }
        .readout-station-name {
            font-size: 13px;
            font-weight: 500;
            color: #90A8C4;
            line-height: 1.4;
        }

        .readout-body { padding: 18px; }

        /* jurisdiction warning */
        .juris-note {
            background: #FFFBEB;
            border: 1px solid #FCD34D;
            border-radius: 6px;
            padding: 10px 13px;
            margin-bottom: 14px;
            font-size: 12px;
            color: #92400E;
            line-height: 1.5;
        }

        /* single time */
        .time-block { text-align: center; padding: 16px 12px 12px; }
        .time-num {
            font-family: 'Playfair Display', serif;
            font-size: 80px;
            font-weight: 700;
            line-height: 0.9;
            color: var(--navy);
            letter-spacing: -2px;
        }
        .time-word {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-light);
            letter-spacing: 1px;
            text-transform: uppercase;
            margin-top: 8px;
        }
        .time-caption {
            font-size: 11px;
            color: var(--text-light);
            margin-top: 5px;
            font-weight: 300;
        }

        /* split time */
        .time-split {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 4px;
        }
        .time-split-cell {
            text-align: center;
            padding: 16px 8px 12px;
            border-radius: 8px;
            background: var(--bg);
        }
        .split-scenario {
            font-size: 9px;
            font-weight: 600;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            color: var(--text-light);
            margin-bottom: 8px;
        }
        .split-num {
            font-family: 'Playfair Display', serif;
            font-size: 60px;
            font-weight: 700;
            line-height: 0.9;
            color: var(--navy);
            letter-spacing: -1px;
        }
        .split-num.expected { color: var(--amber); }
        .split-word {
            font-size: 10px;
            font-weight: 500;
            color: var(--text-light);
            letter-spacing: 1px;
            text-transform: uppercase;
            margin-top: 6px;
        }
        .split-caption {
            font-size: 10px;
            color: var(--text-light);
            margin-top: 4px;
            line-height: 1.4;
            font-weight: 300;
        }

        .readout-dist {
            text-align: center;
            font-size: 12px;
            color: var(--text-light);
            font-weight: 400;
            padding-top: 12px;
            border-top: 1px solid var(--border);
            margin-top: 12px;
        }
        .readout-dist strong { color: var(--text-mid); font-weight: 500; }

        /* ── CONTEXT ── */
        .context {
            background: var(--white);
            border-top: 1px solid var(--border);
            padding: 48px 32px;
        }
        .context-heading {
            font-family: 'Playfair Display', serif;
            font-size: 24px;
            font-weight: 700;
            color: var(--navy);
            margin-bottom: 32px;
        }
        .context-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 28px 48px;
            max-width: 820px;
        }
        @media (max-width: 540px) { .context-grid { grid-template-columns: 1fr; } }
        .context-item {}
        .context-item-heading {
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border);
        }
        .context-item-body {
            font-size: 13px;
            color: var(--text-mid);
            line-height: 1.75;
            font-weight: 300;
            margin-top: 10px;
        }

        /* ── METHODOLOGY ── */
        .methodology {
            background: var(--bg);
            border-top: 1px solid var(--rule);
            padding: 48px 32px;
        }
        .method-heading {
            font-family: 'Playfair Display', serif;
            font-size: 24px;
            font-weight: 700;
            color: var(--navy);
            margin-bottom: 12px;
        }
        .method-intro {
            font-size: 14px;
            color: var(--text-mid);
            line-height: 1.75;
            font-weight: 300;
            max-width: 720px;
            margin-bottom: 32px;
        }
        .method-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 28px 40px;
            margin-bottom: 36px;
            max-width: 880px;
        }
        @media (max-width: 600px) { .method-grid { grid-template-columns: 1fr; } }
        .method-block {}
        .method-block-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--navy);
            text-transform: uppercase;
            letter-spacing: 0.8px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--rule);
            margin-bottom: 12px;
        }
        .method-block-body p {
            font-size: 13px;
            color: var(--text-mid);
            line-height: 1.75;
            font-weight: 300;
            margin-bottom: 8px;
        }
        .method-block-body p:last-child { margin-bottom: 0; }
        .method-block-body strong { color: var(--text); font-weight: 600; }
        .method-sources {
            border-top: 1px solid var(--rule);
            padding-top: 24px;
            max-width: 880px;
        }
        .method-sources-label {
            font-size: 10px;
            font-weight: 600;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--text-light);
            margin-bottom: 12px;
        }
        .method-sources-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 10px;
            counter-reset: source-counter;
        }
        .method-sources-list li {
            font-size: 12px;
            color: var(--text-light);
            line-height: 1.7;
            padding-left: 28px;
            position: relative;
            font-weight: 400;
            counter-increment: source-counter;
        }
        .method-sources-list li::before {
            content: counter(source-counter);
            position: absolute;
            left: 0;
            top: 0;
            width: 18px;
            height: 18px;
            background: var(--navy);
            color: white;
            border-radius: 50%;
            font-size: 9px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 1px;
        }
        .method-sources-list em { font-style: italic; color: var(--text-mid); }
        .method-sources-list strong { color: var(--text); font-weight: 600; }
        sup {
            font-size: 9px;
            font-weight: 700;
            color: var(--navy);
            vertical-align: super;
            line-height: 0;
            margin-left: 1px;
        }

        /* ── CTA ── */
        .cta {
            background: var(--navy);
            padding: 36px 32px;
            text-align: center;
        }
        .cta-label {
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 2.5px;
            text-transform: uppercase;
            color: var(--gold);
            margin-bottom: 12px;
        }
        .cta h2 {
            font-family: 'Playfair Display', serif;
            font-size: 26px;
            font-weight: 700;
            color: white;
            line-height: 1.3;
            margin-bottom: 10px;
        }
        .cta-sub {
            font-size: 14px;
            font-weight: 300;
            color: #90A8C4;
            line-height: 1.7;
            max-width: 400px;
            margin: 0 auto 22px;
        }
        .cta-btn {
            display: inline-block;
            background: var(--gold);
            color: white;
            padding: 14px 28px;
            border-radius: 4px;
            font-family: 'Outfit', sans-serif;
            font-size: 13px;
            font-weight: 600;
            text-decoration: none;
            letter-spacing: 0.4px;
            transition: opacity 0.15s, transform 0.1s;
        }
        .cta-btn:hover { opacity: 0.9; transform: translateY(-1px); }
    </style>
</head>
<body>


<div class="hero">
    <div class="hero-eyebrow">Safe Steps</div>
    <h1>Emergency Response<br>Time Calculator</h1>
    <div class="hero-sub">Understand exactly how long it takes fire and EMS to reach your home — and what your family needs to do in the minutes before they arrive.</div>
</div>

<div class="input-panel">
    <div class="input-label">Your Home Address</div>
    <div class="input-row">
        <input type="text" id="address-input" placeholder="Street address, city, state..." autocomplete="off">
        <button id="search-btn" onclick="runCalculation()">Calculate →</button>
    </div>
</div>

<div class="loading" id="loading">
    <div class="loading-dots">
        <div class="loading-dot"></div>
        <div class="loading-dot"></div>
        <div class="loading-dot"></div>
    </div>
    <div class="loading-label" id="loading-text">Locating emergency stations near you...</div>
</div>

<div class="error-msg" id="error-msg"></div>

<div class="results" id="results">

    <div class="address-bar">
        <div class="address-pin"></div>
        <div class="address-text" id="address-text"></div>
    </div>

    <div class="columns">
        <div class="col">
            <div class="col-heading">
                <div class="col-heading-icon" style="font-size:13px;font-weight:700;letter-spacing:1px;color:white;">FIRE</div>
                <div class="col-heading-text">
                    <div class="col-heading-title">Fire Response</div>
                    <div class="col-heading-sub">Select a station to see response time</div>
                </div>
            </div>
            <div class="station-list" id="fire-list"></div>
            <div id="fire-readout"></div>
        </div>

        <div class="col">
            <div class="col-heading">
                <div class="col-heading-icon" style="font-size:13px;font-weight:700;letter-spacing:1px;color:white;">EMS</div>
                <div class="col-heading-text">
                    <div class="col-heading-title">EMS / Rescue</div>
                    <div class="col-heading-sub">Select a station to see response time</div>
                </div>
            </div>
            <div class="station-list" id="ems-list"></div>
            <div id="ems-readout"></div>
        </div>
    </div>

    <div class="context">
        <div class="context-heading">What These Numbers Mean for Your Family</div>
        <div class="context-grid">
            <div class="context-item">
                <div class="context-item-heading">House Fire</div>
                <div class="context-item-body">A room reaches flashover in 3–5 minutes. Toxic smoke fills the home in 2–3. Whether your family escapes is decided almost entirely before the first truck arrives.</div>
            </div>
            <div class="context-item">
                <div class="context-item-heading">Cardiac Arrest</div>
                <div class="context-item-body">Survival drops 7–10% per minute without CPR. After 10 minutes untreated, odds are poor. Your EMS response time shows exactly how critical in-home CPR training is.</div>
            </div>
            <div class="context-item">
                <div class="context-item-heading">Volunteer Departments</div>
                <div class="context-item-body">Volunteers drive to the station before the truck can leave — adding 4–8 minutes on average, more at night or in bad weather. The expected time above accounts for this.</div>
            </div>
            <div class="context-item">
                <div class="context-item-heading">The Gap That Matters</div>
                <div class="context-item-body">Responders are trained for when they arrive. The minutes before they do are your family's responsibility alone. A practiced emergency plan is the only thing that fills this gap.</div>
            </div>
        </div>
    </div>

    <div class="methodology">
        <div class="method-heading">How We Calculate These Numbers</div>
        <p class="method-intro">The times shown are estimates of <strong>total response time</strong> — from the moment you call 911 to when the first unit arrives at your door. This is not drive time alone. It accounts for every stage in the emergency response chain: call processing, turnout, and travel.</p>

        <div class="method-grid">
            <div class="method-block">
                <div class="method-block-title">Stage 1 — Call Processing</div>
                <div class="method-block-body">
                    <p>For <strong>fire emergencies</strong>, NFPA 1710 sets a benchmark of 64 seconds for call processing — from the moment 911 receives your call to the moment the station is toned out.<sup>1</sup> We apply <strong>~1 minute</strong> for fire dispatch overhead.</p>
                    <p>For <strong>medical emergencies</strong>, dispatchers must run Emergency Medical Dispatch (EMD) protocol before the unit is released — a structured sequence of questions used to determine call priority (BLS vs. ALS), assign the correct unit, and deliver pre-arrival instructions to the caller.<sup>5</sup> This process runs materially longer than fire dispatch. We apply <strong>~3 minutes</strong> for EMS call processing, consistent with real-world EMS response data from jurisdictions like Charlottesville when back-calculated against reported average response times.</p>
                </div>
            </div>

            <div class="method-block">
                <div class="method-block-title">Stage 2 — Turnout Time</div>
                <div class="method-block-body">
                    <p>Turnout time is the interval from when the station alarm sounds to when the apparatus is moving. Personnel must stop current activity, don protective equipment, and board the apparatus. NFPA 1710 sets the benchmark at <strong>80 seconds for fire</strong> and <strong>60 seconds for EMS</strong> responses.<sup>1</sup> Real-world performance falls short of this regularly — career departments met the 80-second turnout standard only 48–66% of the time in documented studies, with nighttime calls running significantly longer.<sup>4</sup> We apply <strong>~2 minutes for fire</strong> and <strong>~1 minute for EMS</strong> as conservative real-world estimates.</p>
                </div>
            </div>

            <div class="method-block">
                <div class="method-block-title">Stage 3 — Drive Time</div>
                <div class="method-block-body">
                    <p>Drive time is calculated using Google Maps routing from the station to your address, using road network data and emergency apparatus travel speeds. NFPA 1710 benchmarks <strong>4 minutes of drive time</strong> for the first arriving engine at 90% of incidents.<sup>1</sup> In practice, 34% of large U.S. cities fail to meet this standard consistently,<sup>3</sup> and the national 90th percentile for total fire response — including all stages — is just under 11 minutes.<sup>4</sup></p>
                </div>
            </div>

            <div class="method-block">
                <div class="method-block-title">Volunteer Departments — Additional Overhead</div>
                <div class="method-block-body">
                    <p>Volunteer firefighters are not stationed on-duty. When toned out, they must first travel from home or work to the station before the truck can leave — a step that does not exist for career departments. The U.S. Fire Administration explicitly defines volunteer turnout time as including this travel-to-station component.<sup>4</sup></p>
                    <p>NFPA 1720, the standard for volunteer departments, sets <strong>total response benchmarks of 9 minutes in urban areas, 10 minutes in suburban areas, and 14 minutes in rural areas</strong> — reflecting this reality.<sup>2</sup> Back-calculating against typical drive times, volunteer pre-drive overhead (travel to station + gear up) runs approximately <strong>4–6 minutes in suburban conditions, and 6–8 minutes overnight or in rural areas</strong>. We apply <strong>+5 minutes of additional overhead</strong> for volunteer fire and <strong>+7 minutes</strong> for volunteer EMS on top of the career baselines, consistent with NFPA 1720 total benchmarks.</p>
                </div>
            </div>
        </div>

        <div class="method-sources">
            <div class="method-sources-label">Sources</div>
            <ol class="method-sources-list">
                <li><strong>NFPA 1710</strong> — <em>Standard for the Organization and Deployment of Fire Suppression Operations, Emergency Medical Operations, and Special Operations to the Public by Career Fire Departments.</em> National Fire Protection Association. Establishes call processing (64 sec), turnout (80 sec fire / 60 sec EMS), and travel time (240 sec) benchmarks for career departments.</li>
                <li><strong>NFPA 1720</strong> — <em>Standard for the Organization and Deployment of Fire Suppression Operations, Emergency Medical Operations, and Special Operations to the Public by Volunteer Fire Departments.</em> National Fire Protection Association. Establishes total response benchmarks: urban 9 min, suburban 10 min, rural 14 min.</li>
                <li><strong>International Association of Fire Fighters (IAFF)</strong> — Survey of response times in the 50 most populous U.S. cities. Findings: 34% of large city career departments do not meet the NFPA 1710 240-second travel time standard.</li>
                <li><strong>U.S. Fire Administration / National Fire Data Center</strong> — <em>Structure Fire Response Times.</em> USFA-TR-153. Documents real-world response time distribution including national 90th percentile, nighttime performance gaps, and explicit definition of volunteer turnout time as including travel-to-station.</li>
                <li><strong>Emergency Medical Dispatch (EMD) Protocol</strong> — International Academies of Emergency Dispatch (IAED). Structured pre-arrival questioning protocol required before EMS unit release; adds materially to call processing time relative to fire dispatch.</li>
            </ol>
        </div>
    </div>

    <div class="cta">
        <div class="cta-label">Next Step</div>
        <h2>You know your response time.<br>Now build your plan.</h2>
        <div class="cta-sub">Safe Steps creates a fully customized emergency response plan for your home and family — so every second before help arrives is accounted for.</div>
        <a href="https://www.safestepsplans.com" class="cta-btn">Get Your Family's Plan</a>
    </div>

</div>

<script>
let appData = null;

// ─── UI Utilities ─────────────────────────────────────────────────────────────
function showError(msg) {
    setLoading(false);
    const el = document.getElementById('error-msg');
    el.textContent = msg;
    el.classList.add('active');
}
function clearError() {
    const el = document.getElementById('error-msg');
    el.textContent = '';
    el.classList.remove('active');
}
function setLoading(on, text) {
    document.getElementById('loading').classList.toggle('active', on);
    if (text) document.getElementById('loading-text').textContent = text;
    document.getElementById('search-btn').disabled = on;
}
function showResults(on) {
    document.getElementById('results').classList.toggle('active', on);
}

// ─── Backend — exact same pattern as fridge sheet ─────────────────────────────
const PROXY = 'https://www.safestepsplans.com/_functions/places';

async function placesCall(body) {
    const res = await fetch(PROXY, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
    });
    if (!res.ok) throw new Error('HTTP ' + res.status);
    return res.json();
}

async function getDriving(origin, destLat, destLng) {
    try {
        const res = await placesCall({ type: 'directions', origin, dest: destLat + ',' + destLng });
        if (res.error) return null;
        return { distance: res.distance, duration: res.duration };
    } catch { return null; }
}

// ─── Dept type detection ───────────────────────────────────────────────────────
function detectDeptType(name) {
    const n = (name || '').toUpperCase();
    if (/VOLUNTEER|\bVFD\b|\bVFC\b|\bVFRS\b/.test(n)) return 'volunteer';
    if (/\bCITY\b|\bCOUNTY\b|\bMETRO\b|\bMUNICIPAL\b|\bCAREER\b/.test(n)) return 'career';
    return 'unknown';
}

// ─── Render helpers ───────────────────────────────────────────────────────────
function buildReadout(station, type) {
    const isFire = (type === 'fire');
    const careerOverhead = isFire ? 3 : 4;
    const volOverhead    = isFire ? 8 : 10;
    const driveMin = station.drive_minutes;
    const total    = driveMin + (station.dept_type === 'volunteer' ? volOverhead : careerOverhead);
    const color    = station.dept_type === 'volunteer' ? 'var(--amber)' : 'var(--navy)';
    const outsideNote = station.in_town ? '' : ' · outside your municipality, may respond as mutual aid';
    const caption = station.dept_type === 'volunteer'
        ? (isFire
            ? `Estimated total response time · ~1 min dispatch + ~2 min turnout + ~5 min volunteer call-out + ${driveMin} min drive${outsideNote}`
            : `Estimated total response time · ~3 min EMD protocol + ~2 min turnout + ~5 min volunteer call-out + ${driveMin} min drive${outsideNote}`)
        : (isFire
            ? `Estimated total response time · ~1 min dispatch + ~2 min turnout + ${driveMin} min drive${outsideNote}`
            : `Estimated total response time · ~3 min EMD protocol + ~1 min turnout + ${driveMin} min drive${outsideNote}`);
    return `
        <div class="readout-card">
            <div class="readout-top">
                <div class="readout-station-name">${station.station_name}</div>
            </div>
            <div class="readout-body">
                <div class="time-block">
                    <div class="time-num" style="color:${color}">${total}</div>
                    <div class="time-word">Minutes</div>
                    <div class="time-caption">${caption}</div>
                </div>
                <div class="readout-dist"><strong>${station.distance_miles} miles</strong> driving distance</div>
            </div>
        </div>`;
}

function buildList(type, stations, activeIdx) {
    const listEl = document.getElementById(type + '-list');
    listEl.innerHTML = '';
    stations.forEach((s, i) => {
        const item = document.createElement('div');
        item.className = 'station-item' + (i === activeIdx ? ' selected' : '');
        item.onclick = () => selectStation(type, i);
        let deptPill = '';
        if (s.dept_type === 'career')         deptPill = '<span class="pill pill-career">Career</span>';
        else if (s.dept_type === 'volunteer') deptPill = '<span class="pill pill-volunteer">Volunteer</span>';
        else                                  deptPill = '<span class="pill pill-unknown">Type Unknown</span>';
        const jurisdPill = s.in_town
            ? '<span class="pill pill-town">In Town</span>'
            : '<span class="pill pill-outside">Out of Town</span>';
        item.innerHTML = `
            <div class="station-selector"></div>
            <div class="station-item-body">
                <div class="station-item-name">${s.station_name}</div>
                <div class="station-item-address">${s.address || ''}</div>
                <div class="pill-row">
                    ${deptPill}${jurisdPill}
                    <span class="pill-dist">${s.distance_miles} mi</span>
                </div>
            </div>`;
        listEl.appendChild(item);
    });
}

function selectStation(type, idx) {
    const stations = type === 'fire' ? appData.fire_stations : appData.ems_stations;
    document.querySelectorAll('#' + type + '-list .station-item').forEach((el, i) => {
        el.classList.toggle('selected', i === idx);
    });
    document.getElementById(type + '-readout').innerHTML = buildReadout(stations[idx], type);
}

// ─── Main calculation ──────────────────────────────────────────────────────────
async function runCalculation() {
    const address = document.getElementById('address-input').value.trim();
    if (!address) { showError('Please enter your home address.'); return; }
    clearError();
    showResults(false);

    try {
        // Stage 1: Geocode
        setLoading(true, 'Locating your address...');
        const geo = await placesCall({ type: 'geocode', address });
        if (geo.error) throw new Error('Address not found: ' + geo.status);
        const { lat, lng } = geo;

        // Extract municipality from address string for in-town detection
        const parts = address.split(',').map(s => s.trim());
        const municipality = parts.length >= 3 ? parts[parts.length - 3] : parts[0] || '';

        // Stage 2: Fire stations
        setLoading(true, 'Finding fire stations near you...');
        const fireNearby = await placesCall({ type: 'nearby', lat, lng, placeType: 'fire_station', rankby: 'distance' });
        const firePlaces = (fireNearby.results || []).slice(0, 5);

        // Stage 3: EMS
        setLoading(true, 'Finding EMS and rescue stations...');
        const emsNearby = await placesCall({ type: 'nearby', lat, lng, keywords: ['rescue squad', 'EMS', 'ambulance corps'], rankby: 'distance' });
        const emsPlaces = (emsNearby.results || []).slice(0, 5);

        // Stage 4: Drive times — same pattern as fridge sheet: pass lat,lng not address string
        setLoading(true, 'Calculating drive times...');

        const buildStations = async (places) => {
            const results = await Promise.all(places.map(async p => {
                try {
                    const [det, drive] = await Promise.all([
                        placesCall({ type: 'details', place_id: p.place_id }),
                        getDriving(address, p.lat, p.lng)
                    ]);
                    const driveMin = drive ? parseDuration(drive.duration) : 99;
                    const in_town = municipality ? (det.address || p.address || '').toLowerCase().includes(municipality.toLowerCase()) : false;
                    return {
                        station_name:   det.name || p.name,
                        address:        det.address || p.address || '',
                        dept_type:      detectDeptType(det.name || p.name),
                        in_town,
                        drive_minutes:  driveMin,
                        distance_miles: drive ? drive.distance.replace(' mi', '') : '?',
                        _drive_min:     driveMin
                    };
                } catch {
                    return null;
                }
            }));
            return results.filter(Boolean);
        };

        const [fireStations, emsStations] = await Promise.all([
            buildStations(firePlaces),
            buildStations(emsPlaces)
        ]);

        // Sort: fire = in-town first, then by drive time. EMS = drive time only.
        fireStations.sort((a, b) => a.in_town !== b.in_town ? (a.in_town ? -1 : 1) : a._drive_min - b._drive_min);
        emsStations.sort((a, b) => a._drive_min - b._drive_min);

        if (!fireStations.length) throw new Error('No fire stations found near this address.');

        appData = {
            formatted_address: address,
            municipality,
            fire_stations: fireStations.slice(0, 3),
            ems_stations:  (emsStations.length ? emsStations : fireStations).slice(0, 3)
        };

        setLoading(false);
        document.getElementById('address-text').textContent = address;
        buildList('fire', appData.fire_stations, 0);
        buildList('ems',  appData.ems_stations,  0);
        document.getElementById('fire-readout').innerHTML = buildReadout(appData.fire_stations[0], 'fire');
        document.getElementById('ems-readout').innerHTML  = buildReadout(appData.ems_stations[0],  'ems');
        showResults(true);

    } catch(err) {
        showError(err.message || 'Something went wrong. Please try again.');
        setLoading(false);
    }
}

// Parse "7 mins" or "1 hour 3 mins" → integer minutes
function parseDuration(str) {
    if (!str) return 99;
    const h = str.match(/(\d+)\s*hour/);
    const m = str.match(/(\d+)\s*min/);
    return ((h ? parseInt(h[1]) : 0) * 60) + (m ? parseInt(m[1]) : 0);
}

document.getElementById('address-input').addEventListener('keydown', e => {
    if (e.key === 'Enter') runCalculation();
});

// ─── Auto-height reporting to Wix parent ─────────────────────────────────────
function reportHeight() {
    const height = document.body.scrollHeight;
    window.parent.postMessage({ action: 'resize', height }, '*');
}
window.addEventListener('load', reportHeight);
const resizeObserver = new ResizeObserver(reportHeight);
resizeObserver.observe(document.body);
</script>
</body>
</html>
